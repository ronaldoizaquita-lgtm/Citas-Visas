<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Agenda de Visas - ECCI</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --ecci-blue:#003788;
  --bg:#f7f9fc;
  --card:#ffffff;
  --muted:#6b7280;
  --radius:14px;
}

body{
  margin:0;
  padding:32px;
  background:var(--bg);
  font-family:"Inter",sans-serif;
  color:#0f172a;
  display:flex;
  justify-content:center;
}

.container{
  max-width:1100px;
  width:100%;
  display:grid;
  grid-template-columns:1fr 380px;
  gap:24px;
}

@media(max-width:900px){
  .container{ grid-template-columns:1fr }
}

.card{
  background:var(--card);
  border-radius:var(--radius);
  padding:22px;
  box-shadow:0 8px 28px rgba(0,0,0,0.06);
}

.header{
  grid-column:1 / -1;
}

.header h1{
  margin:0;
  color:var(--ecci-blue);
}

.header p{
  margin:0;
  font-size:14px;
  color:var(--muted);
}

input, select, textarea{
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid #cfd6e4;
  font-size:15px;
  box-sizing:border-box;
}

.row{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}

@media(max-width:600px){
  .row{ grid-template-columns:1fr }
}

.btn{
  padding:10px 14px;
  border-radius:10px;
  cursor:pointer;
  border:none;
  font-weight:600;
}

.btn.primary{ background:var(--ecci-blue); color:white; }
.btn.ghost{ background:white; border:1px solid #ddd; }
.btn.danger{ background:#d92b2b; color:white; }

.appointment{
  border:1px solid #e3e6ef;
  padding:12px;
  border-radius:12px;
  margin-bottom:10px;
}

</style>
</head>

<body>
<div class="container">

  <div class="header">
    <h1>Agenda de Visas – ECCI</h1>
    <p>Gestión de citas y movilidad internacional</p>
  </div>

  <!-- FORMULARIO -->
  <section class="card">
    <h2 style="color:var(--ecci-blue); margin-top:0">Agendar Cita</h2>

    <form id="form">

      <div class="row">
        <div>
          <label>Nombre completo *</label>
          <input name="fullName" required>
        </div>
        <div>
          <label>Correo *</label>
          <input type="email" name="email" required>
        </div>
      </div>

      <div class="row" style="margin-top:12px">
        <div>
          <label>Teléfono / WhatsApp *</label>
          <input name="phone" required>
        </div>
        <div>
          <label>Pasaporte</label>
          <input name="passport">
        </div>
      </div>

      <div style="margin-top:12px">
        <label>Tipo de Visa *</label>
        <select name="visaType" required>
          <option value="">Seleccione</option>
          <option>Turismo</option>
          <option>Estudios</option>
          <option>Trabajo</option>
          <option>Intercambio</option>
          <option>Otro</option>
        </select>
      </div>

      <div class="row" style="margin-top:12px">
        <div>
          <label>Fecha *</label>
          <input type="date" name="date" required>
        </div>
        <div>
          <label>Hora *</label>
          <input type="time" name="time" required>
        </div>
      </div>

      <div style="margin-top:12px">
        <label>Notas</label>
        <textarea name="notes" rows="3"></textarea>
      </div>

      <div style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap">
        <button class="btn primary" type="submit">Guardar</button>
        <button class="btn ghost" type="button" id="clear">Limpiar</button>
      </div>

    </form>
  </section>

  <!-- LISTA -->
  <aside class="card">
    <h2 style="color:var(--ecci-blue); margin-top:0">Citas Guardadas</h2>

    <input id="search" placeholder="Buscar..." style="margin-bottom:10px">

    <div id="list"></div>

    <div style="display:flex; gap:10px; margin-top:12px">
      <button class="btn ghost" id="export">Exportar CSV</button>
      <button class="btn danger" id="deleteAll">Borrar Todo</button>
    </div>
  </aside>

</div>

<script>
let data = JSON.parse(localStorage.getItem("citas_ecci") || "[]");

const form = document.getElementById("form");
const list = document.getElementById("list");
const search = document.getElementById("search");

function save(){
  localStorage.setItem("citas_ecci", JSON.stringify(data));
  render();
}

function render(){
  list.innerHTML = "";
  const q = search.value.toLowerCase();

  const filtered = data.filter(c =>
    (c.fullName + c.phone + c.visaType).toLowerCase().includes(q)
  );

  if(filtered.length === 0){
    list.innerHTML = "<p style='color:#888'>No hay citas registradas.</p>";
    return;
  }

  filtered.forEach(c=>{
    const div = document.createElement("div");
    div.className = "appointment";
    div.innerHTML = `
      <strong>${c.fullName}</strong><br>
      <span>${c.visaType} – ${c.date} ${c.time}</span><br>
      <span>${c.email}</span><br><br>
      <button class="btn ghost" onclick="openWhats('${c.phone}','${c.fullName}')">WhatsApp</button>
    `;
    list.appendChild(div);
  });
}

function openWhats(phone, name){
  const msg = encodeURIComponent(`Hola, soy ${name} y deseo información sobre mi cita de visa.`);
  window.open(`https://wa.me/${phone}?text=${msg}`, "_blank");
}

form.addEventListener("submit", e=>{
  e.preventDefault();
  const fd = Object.fromEntries(new FormData(form).entries());

  data.push(fd);
  save();

  form.reset();
  alert("Cita guardada.");
});

document.getElementById("clear").onclick = ()=> form.reset();

document.getElementById("deleteAll").onclick = ()=>{
  if(confirm("¿Eliminar todas las citas?")){
    data = [];
    save();
  }
};

document.getElementById("export").onclick = ()=>{
  let csv = "Nombre,Correo,Teléfono,Pasaporte,Visa,Fecha,Hora,Notas\n";
  data.forEach(c=>{
    csv += `${c.fullName},${c.email},${c.phone},${c.passport},${c.visaType},${c.date},${c.time},"${c.notes}"\n`;
  });

  const blob = new Blob([csv], {type:"text/csv"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "citas.csv";
  a.click();
};

search.addEventListener("input", render);

render();
</script>

</body>
</html>
